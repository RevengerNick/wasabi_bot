require('dotenv').config(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env —Ñ–∞–π–ª–∞
const { Telegraf, Markup } = require('telegraf');

const token = process.env.BOT_TOKEN;
if (!token) {
    throw new Error('BOT_TOKEN must be provided!');
}

const webAppUrl = process.env.FRONT_URL;

const bot = new Telegraf(token);

// –°–æ–∑–¥–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –ø–æ–º–æ—â—å—é Markup
const mainKeyboard = Markup.keyboard([
    [{ text: '‚úÖ –ó–∞–∫–∞–∑–∞—Ç—å', web_app: { url: webAppUrl } }],
    ['üõí –ö–æ—Ä–∑–∏–Ω–∞', '‚ÑπÔ∏è –û –Ω–∞—Å'],
    ['üìñ –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤']
]).resize(); // .resize() –¥–µ–ª–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ –±–æ–ª–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–º–∏

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start
bot.start((ctx) => {
    ctx.reply(
        `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, ${ctx.from.first_name}! üëã\n\n–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à —Å—É—à–∏-–±–æ—Ç. –ß—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ.`,
        mainKeyboard
    );
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∫–Ω–æ–ø–∫–∏ —á–µ—Ä–µ–∑ bot.hears()
bot.hears('üõí –ö–æ—Ä–∑–∏–Ω–∞', (ctx) => {
    ctx.reply('–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø–æ–∫–∞ –ø—É—Å—Ç–∞. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–∫–∞–∑–∞—Ç—å", —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å —á—Ç–æ-–Ω–∏–±—É–¥—å –≤–∫—É—Å–Ω–æ–µ!');
});

bot.hears('‚ÑπÔ∏è –û –Ω–∞—Å', (ctx) => {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º parse_mode: 'MarkdownV2' –∏–ª–∏ 'HTML' –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    ctx.replyWithHTML(
        'üç£ <b>Wasabi Sushi</b>\n\n' +
        '<b>–ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã:</b> 11:00 - 23:00\n' +
        '–ë–µ–∑ –≤—ã—Ö–æ–¥–Ω—ã—Ö\n\n' +
        'üìû +998901234567\n\n' +
        'üìç <b>–ê–¥—Ä–µ—Å:</b> –≥. –¢–∞—à–∫–µ–Ω—Ç, —É–ª. –ö–∞–∫–∞—è-—Ç–æ, 1'
    );
});

bot.hears('üìñ –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤', (ctx) => {
    ctx.reply('–ß—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–∞–∫–∞–∑–æ–≤, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ —Å –ø–æ–º–æ—â—å—é –≤–∞—à–µ–≥–æ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ (–∫–Ω–æ–ø–∫–∞ "–ó–∞–∫–∞–∑–∞—Ç—å").');
});

bot.launch();

console.log('–ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω –Ω–∞ Telegraf!');

// –í–∫–ª—é—á–∞–µ–º graceful stop, —á—Ç–æ–±—ã –±–æ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞–ª —Ä–∞–±–æ—Ç—É
process.once('SIGINT', () => bot.stop('SIGINT'));
process.once('SIGTERM', () => bot.stop('SIGTERM'));